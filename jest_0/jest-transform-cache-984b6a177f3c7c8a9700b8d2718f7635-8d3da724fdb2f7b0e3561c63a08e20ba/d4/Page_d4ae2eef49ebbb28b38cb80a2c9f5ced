/* istanbul ignore next */'use strict';Object.defineProperty(exports, "__esModule", { value: true });var /* istanbul ignore next */_react = require('react'); /* istanbul ignore next */var _react2 = _interopRequireDefault(_react);
var /* istanbul ignore next */_meteor = require('meteor/meteor');
var /* istanbul ignore next */_reactMeteorData = require('meteor/react-meteor-data');
var /* istanbul ignore next */_session = require('meteor/session');


var /* istanbul ignore next */_utils = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/lib/utils'); /* istanbul ignore next */var _utils2 = _interopRequireDefault(_utils);


var /* istanbul ignore next */_pages = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/api/collections/pages'); /* istanbul ignore next */var _pages2 = _interopRequireDefault(_pages);
var /* istanbul ignore next */_settings = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/api/collections/settings'); /* istanbul ignore next */var _settings2 = _interopRequireDefault(_settings);


var /* istanbul ignore next */_NotFound = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/ui/layouts/notFound/NotFound'); /* istanbul ignore next */var _NotFound2 = _interopRequireDefault(_NotFound);


var /* istanbul ignore next */_BackgroundImageHolder = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/ui/components/shared/BackgroundImageHolder'); /* istanbul ignore next */var _BackgroundImageHolder2 = _interopRequireDefault(_BackgroundImageHolder);
var /* istanbul ignore next */_LoadingPage = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/ui/components/loading/LoadingPage'); /* istanbul ignore next */var _LoadingPage2 = _interopRequireDefault(_LoadingPage);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };} // components
// lib

var Page = /* istanbul ignore next */_react2.default.createClass({ /* istanbul ignore next */displayName: 'Page',
	propTypes: {
		slug: /* istanbul ignore next */_react2.default.PropTypes.string,
		page: /* istanbul ignore next */_react2.default.PropTypes.object,
		ready: /* istanbul ignore next */_react2.default.PropTypes.bool,
		images: /* istanbul ignore next */_react2.default.PropTypes.array,
		thumbnails: /* istanbul ignore next */_react2.default.PropTypes.array,
		loading: /* istanbul ignore next */_react2.default.PropTypes.bool,
		settings: /* istanbul ignore next */_react2.default.PropTypes.object }, /* istanbul ignore next */


	render: function render() {/* istanbul ignore next */var _props =
		this.props,page = _props.page,settings = _props.settings,slug = _props.slug,loading = _props.loading;
		var headerImageUrl = '/images/apotheosis_homer.jpg';

		if (loading) {
			return (
				/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */_LoadingPage2.default, /* istanbul ignore next */null));

		} else if (!loading && !page) {
			return (
				/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */_NotFound2.default, /* istanbul ignore next */{
					isTest: slug === '__test__' }));


		}

		if (page && page.title) {
			/* istanbul ignore next */_utils2.default.setTitle( /* istanbul ignore next */page.title + ' | ' + settings.title);
		}
		if (headerImageUrl) {
			/* istanbul ignore next */_utils2.default.setMetaImage(headerImageUrl);
		}

		return (
			// todo: return 404 if !page.length
			/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: /* istanbul ignore next */'page page-' + slug + ' content primary' },

				/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'section', /* istanbul ignore next */{ className: 'block header header-page cover parallax' },
					/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */_BackgroundImageHolder2.default, /* istanbul ignore next */{
						imgSrc: '/images/apotheosis_homer.jpg' }),


					/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'container v-align-transform' },
						/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'grid inner' },
							/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'center-content' },
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'page-title-wrap' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h1', /* istanbul ignore next */{ className: 'page-title' },
										page.title),

									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h2', /* istanbul ignore next */null,
										page.subtitle)))))),







				/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'section', /* istanbul ignore next */{ className: 'page-content container' },
					page.byline ?
					/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'page-byline' },
						/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h3', /* istanbul ignore next */null,
							page.byline)) :


					'',
					/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ dangerouslySetInnerHTML: { __html: page.content } }))));



	} }); // layouts
// api

var pageContainer = /* istanbul ignore next */(0, _reactMeteorData.createContainer)(function ( /* istanbul ignore next */_ref) {/* istanbul ignore next */var slug = _ref.slug;
	var page = {};
	var images = [];
	var thumbnails = [];
	var handle = /* istanbul ignore next */_meteor.Meteor.subscribe('pages', slug);
	var loading = true;
	var settingsHandle = /* istanbul ignore next */_meteor.Meteor.subscribe('settings.tenant', /* istanbul ignore next */_session.Session.get('tenantId'));

	if (handle.ready()) {
		page = /* istanbul ignore next */_pages2.default.find({ slug: slug }).fetch()[0];
		var imageSub = /* istanbul ignore next */_meteor.Meteor.subscribe('pageImages', slug);
		if (page && imageSub.ready()) {
			if (page.headerImage && Array.isArray(page.headerImage)) {
				images = Images.find({ _id: { $in: page.headerImage } }).fetch();
				thumbnails = Thumbnails.find({ originalId: { $in: page.headerImage } }).fetch();
			}
		}
		loading = false;
	}

	return {
		page: page,
		ready: handle.ready(),
		images: images,
		thumbnails: thumbnails,
		loading: loading,
		settings: settingsHandle.ready() ? /* istanbul ignore next */_settings2.default.findOne() : { title: '' } };

}, Page); /* istanbul ignore next */exports.default =

pageContainer;