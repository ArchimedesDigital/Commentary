/* istanbul ignore next */'use strict';Object.defineProperty(exports, "__esModule", { value: true });var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();













var /* istanbul ignore next */_react = require('react'); /* istanbul ignore next */var _react2 = _interopRequireDefault(_react);
var /* istanbul ignore next */_meteor = require('meteor/meteor');


var /* istanbul ignore next */_ContextPanelContent = require('./ContextPanelContent'); /* istanbul ignore next */var _ContextPanelContent2 = _interopRequireDefault(_ContextPanelContent);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self, call) {if (!self) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call && (typeof call === "object" || typeof call === "function") ? call : self;}function _inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;} /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	HOW TO USE:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	1. Used to show selected lines for commentGroup:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	- props to be set:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	2. Used to select lines to be commented in editor:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	- props to be set:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */ // private component:
/*
	helpers
*/var getLineFrom = function getLineFrom(props) {if (props.commentGroup) return props.commentGroup.lineFrom;if (props.workSlug) return props.lineFrom;throw new /* istanbul ignore next */_meteor.Meteor.Error('commentGroup or lineFrom missing in ContextPanel component - one of two is requierd');};var getWorkSlug = function getWorkSlug(props) {if (props.commentGroup) return props.commentGroup.work.slug;if (props.workSlug) return props.workSlug;throw new /* istanbul ignore next */_meteor.Meteor.Error('commentGroup or workSlug missing in ContextPanel component - one of two is requierd');
};
var getsubworkN = function getsubworkN(props) {
	if (props.commentGroup) return props.commentGroup.subwork.n;
	if (props.subworkN) return props.subworkN;
	throw new /* istanbul ignore next */_meteor.Meteor.Error('commentGroup or subworkN missing in ContextPanel component - one of two is requierd');
};

var LINE_THRESHOLD = 25; /* istanbul ignore next */var


ContextPanel = function (_React$Component) {_inherits(ContextPanel, _React$Component);








































	function /* istanbul ignore next */ContextPanel(props) {/* istanbul ignore next */_classCallCheck(this, ContextPanel);var _this = _possibleConstructorReturn(this, (ContextPanel.__proto__ || Object.getPrototypeOf(ContextPanel)).call(this,
		props));

		/* istanbul ignore next */_this.state = {
			selectedLemmaEdition: '',
			lineFrom: getLineFrom(props),
			maxLine: 0,
			highlightingVisible: true };


		/* istanbul ignore next */_this.setMaxLine();

		// methods:
		/* istanbul ignore next */_this.onAfterClicked = /* istanbul ignore next */_this.onAfterClicked.bind( /* istanbul ignore next */_this);
		/* istanbul ignore next */_this.onBeforeClicked = /* istanbul ignore next */_this.onBeforeClicked.bind( /* istanbul ignore next */_this);
		/* istanbul ignore next */_this.toggleEdition = /* istanbul ignore next */_this.toggleEdition.bind( /* istanbul ignore next */_this);
		/* istanbul ignore next */_this.toggleHighlighting = /* istanbul ignore next */_this.toggleHighlighting.bind( /* istanbul ignore next */_this);
		/* istanbul ignore next */_this.scrollElement = /* istanbul ignore next */_this.scrollElement.bind( /* istanbul ignore next */_this);
		/* istanbul ignore next */_this.setMaxLine = /* istanbul ignore next */_this.setMaxLine.bind( /* istanbul ignore next */_this); /* istanbul ignore next */return _this;
	}_createClass(ContextPanel, [{ key: 'componentDidMount', value: function componentDidMount()

		{
			this.scrollElement('open');
		} }, { key: 'componentDidUpdate', value: function componentDidUpdate(

		prevProps, prevState) {
			var isLemmaEditionChange = prevState.selectedLemmaEdition !== this.state.selectedLemmaEdition;
			var isHighlightingChange = prevState.highlightingVisible !== this.state.highlightingVisible;
			if (!(isLemmaEditionChange || isHighlightingChange)) {
				this.scrollElement('open');
			}

			// if work or subwork updated - update maxline
			if (prevProps.workSlug !== this.props.workSlug || prevProps.subworkN !== this.props.subworkN) {
				this.setMaxLine();
			}
		} }, { key: 'onAfterClicked', value: function onAfterClicked()

		{
			if (this.state.lineFrom + 49 <= this.state.maxLine) {
				this.setState({
					lineFrom: this.state.lineFrom + LINE_THRESHOLD });

			}
		} }, { key: 'onBeforeClicked', value: function onBeforeClicked()

		{/* istanbul ignore next */var

			lineFrom = this.state.lineFrom;

			if (lineFrom >= LINE_THRESHOLD) {
				this.setState({
					lineFrom: lineFrom - LINE_THRESHOLD });

			} else if (lineFrom !== 1) {
				this.setState({
					lineFrom: 1 });

			}
		} }, { key: 'setMaxLine', value: function setMaxLine()

		{/* istanbul ignore next */var _this2 = this;

			var workSlug = getWorkSlug(this.props);
			var subworkN = getsubworkN(this.props);

			/* istanbul ignore next */_meteor.Meteor.call('getMaxLine', workSlug, subworkN, function (err, res) {
				if (err) throw new /* istanbul ignore next */_meteor.Meteor.Erorr(err);
				/* istanbul ignore next */_this2.setState({
					maxLine: res });

			});
		} }, { key: 'toggleEdition', value: function toggleEdition(

		editionSlug) {
			if (this.state.selectedLemmaEdition !== editionSlug) {
				this.setState({
					selectedLemmaEdition: editionSlug });

			}
		} }, { key: 'toggleHighlighting', value: function toggleHighlighting()

		{
			this.setState({
				highlightingVisible: !this.state.highlightingVisible });

		} }, { key: 'scrollElement', value: function scrollElement(

		state) {/* istanbul ignore next */var _this3 = this;
			if (!this.props.editor) {
				switch (state) {
					case 'open':
						window.requestAnimationFrame(function () {
							setTimeout(function () {
								var scroll = $( /* istanbul ignore next */'#comment-group-' + /* istanbul ignore next */_this3.props.commentLemmaIndex).offset().top;
								$(document).scrollTop(scroll);
							}, 300);
						});
						break;
					case 'close':
						window.requestAnimationFrame(function () {
							setTimeout(function () {
								var scroll = $( /* istanbul ignore next */'#comment-group-' + /* istanbul ignore next */_this3.props.commentLemmaIndex).offset().top;
								$(document).scrollTop(scroll);
							}, 1000);
						});
						break;
					default:
						break;}

			}
		} }, { key: 'render', value: function render()

		{/* istanbul ignore next */var _props =

			this.props,open = _props.open,closeContextPanel = _props.closeContextPanel,commentGroup = _props.commentGroup,disableEdit = _props.disableEdit,selectedLineFrom = _props.selectedLineFrom,selectedLineTo = _props.selectedLineTo,updateSelectedLines = _props.updateSelectedLines,editor = _props.editor; /* istanbul ignore next */var _state =
			this.state,highlightingVisible = _state.highlightingVisible,lineFrom = _state.lineFrom,maxLine = _state.maxLine,selectedLemmaEdition = _state.selectedLemmaEdition;

			var workSlug = getWorkSlug(this.props);
			var subworkN = getsubworkN(this.props);

			return (
				/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */_ContextPanelContent2.default, /* istanbul ignore next */{
					open: open,
					closeContextPanel: closeContextPanel,
					workSlug: workSlug,
					subworkN: subworkN,
					commentGroup: commentGroup,
					highlightingVisible: highlightingVisible,
					lineFrom: lineFrom,
					maxLine: maxLine,
					selectedLemmaEdition: selectedLemmaEdition,
					onBeforeClicked: this.onBeforeClicked,
					onAfterClicked: this.onAfterClicked,
					toggleEdition: this.toggleEdition,
					toggleHighlighting: this.toggleHighlighting,

					disableEdit: disableEdit,
					selectedLineFrom: selectedLineFrom,
					selectedLineTo: selectedLineTo,
					updateSelectedLines: updateSelectedLines,
					editor: editor }));


		} }]);return ContextPanel;}( /* istanbul ignore next */_react2.default.Component); /* istanbul ignore next */ContextPanel.propTypes = { open: /* istanbul ignore next */_react2.default.PropTypes.bool.isRequired, commentGroup: /* istanbul ignore next */_react2.default.PropTypes.shape({ work: /* istanbul ignore next */_react2.default.PropTypes.shape({ slug: /* istanbul ignore next */_react2.default.PropTypes.string.isRequired }), subwork: /* istanbul ignore next */_react2.default.PropTypes.shape({ n: /* istanbul ignore next */_react2.default.PropTypes.number.isRequired }), lineFrom: /* istanbul ignore next */_react2.default.PropTypes.number.isRequired, lineTo: /* istanbul ignore next */_react2.default.PropTypes.number, ref: /* istanbul ignore next */_react2.default.PropTypes.string.isRequired }), closeContextPanel: /* istanbul ignore next */_react2.default.PropTypes.func, commentLemmaIndex: /* istanbul ignore next */_react2.default.PropTypes.string, // requiered if editor:
	disableEdit: /* istanbul ignore next */_react2.default.PropTypes.bool, selectedLineFrom: /* istanbul ignore next */_react2.default.PropTypes.number, selectedLineTo: /* istanbul ignore next */_react2.default.PropTypes.number, updateSelectedLines: /* istanbul ignore next */_react2.default.PropTypes.func, workSlug: /* istanbul ignore next */_react2.default.PropTypes.string, subworkN: /* istanbul ignore next */_react2.default.PropTypes.number, editor: /* istanbul ignore next */_react2.default.PropTypes.bool }; /* istanbul ignore next */ContextPanel.defaultProps = { commentGroup: null, closeContextPanel: null, commentLemmaIndex: null, disableEdit: false, selectedLineFrom: 0, selectedLineTo: 0, updateSelectedLines: null, workSlug: null, subworkN: null, editor: false }; /* istanbul ignore next */exports.default =

ContextPanel;