/* istanbul ignore next */'use strict';Object.defineProperty(exports, "__esModule", { value: true });var /* istanbul ignore next */_react = require('react'); /* istanbul ignore next */var _react2 = _interopRequireDefault(_react);
var /* istanbul ignore next */_meteor = require('meteor/meteor');
var /* istanbul ignore next */_session = require('meteor/session');
var /* istanbul ignore next */_reactMeteorData = require('meteor/react-meteor-data');
var /* istanbul ignore next */_getMuiTheme = require('material-ui/styles/getMuiTheme'); /* istanbul ignore next */var _getMuiTheme2 = _interopRequireDefault(_getMuiTheme);


var /* istanbul ignore next */_discussionComments = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/api/collections/discussionComments'); /* istanbul ignore next */var _discussionComments2 = _interopRequireDefault(_discussionComments);


var /* istanbul ignore next */_BackgroundImageHolder = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/ui/components/shared/BackgroundImageHolder'); /* istanbul ignore next */var _BackgroundImageHolder2 = _interopRequireDefault(_BackgroundImageHolder);
var /* istanbul ignore next */_LoadingPage = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/ui/components/loading/LoadingPage'); /* istanbul ignore next */var _LoadingPage2 = _interopRequireDefault(_LoadingPage);


var /* istanbul ignore next */_muiTheme = require('/Users/Tyler/Desktop/AHCIP/ahcip/imports/lib/muiTheme'); /* istanbul ignore next */var _muiTheme2 = _interopRequireDefault(_muiTheme);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };} // api


var PublicProfilePage = /* istanbul ignore next */_react2.default.createClass({ /* istanbul ignore next */displayName: 'PublicProfilePage',
	propTypes: {
		userId: /* istanbul ignore next */_react2.default.PropTypes.string,
		user: /* istanbul ignore next */_react2.default.PropTypes.object,
		discussionComments: /* istanbul ignore next */_react2.default.PropTypes.array },


	childContextTypes: {
		muiTheme: /* istanbul ignore next */_react2.default.PropTypes.object.isRequired }, /* istanbul ignore next */


	getInitialState: function getInitialState() {
		return {
			skip: 0,
			limit: 100,
			userEmail: null };

	}, /* istanbul ignore next */

	getChildContext: function getChildContext() {
		return {
			muiTheme: /* istanbul ignore next */(0, _getMuiTheme2.default)( /* istanbul ignore next */_muiTheme2.default) };

	}, /* istanbul ignore next */

	checkUsername: function checkUsername(user) {
		if (user.username !== FlowRouter.getParam('username')) {
			var route = /* istanbul ignore next */'/users/' + FlowRouter.getParam('userId');
			FlowRouter.go(route);
		}
	}, /* istanbul ignore next */

	render: function render() {/* istanbul ignore next */var _props =
		this.props,user = _props.user,discussionComments = _props.discussionComments;
		var avatarUrl = '/images/default_user.jpg';

		if (!user) {
			return (/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */_LoadingPage2.default, /* istanbul ignore next */null));
		}

		if (!user.profile) {
			user.profile = {};
		}
		if ('avatarUrl' in user.profile) {
			avatarUrl = user.profile.avatarUrl;
		}

		return (
			/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'page page-user-profile page-user-profile--public' },
				/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'content primary' },
					/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'section', /* istanbul ignore next */{ className: 'block header cover parallax' },
						/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */_BackgroundImageHolder2.default, /* istanbul ignore next */{
							imgSrc: '/images/capitals.jpg' })),


					/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'section', /* istanbul ignore next */{ className: 'page-content' },
						/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */null,
							/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'user-profile-section' },
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'user-profile-picture-container' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'user-profile-picture' },
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'img', /* istanbul ignore next */{ alt: 'avatar', src: avatarUrl })))),



							/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null),
							/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'user-profile-textfields' },
								user.profile.name ?
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */null,
									user.username ?
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-name' },
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h2', /* istanbul ignore next */null, user.profile.name, /* istanbul ignore next */' (', user.username, /* istanbul ignore next */')'),
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-name' },
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h2', /* istanbul ignore next */null, user.profile.name),
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null))) :



								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */null,
									user.username ?
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-name' },
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h2', /* istanbul ignore next */null, user.username),
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-name' },
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h2', /* istanbul ignore next */null, /* istanbul ignore next */'No name'),
										/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null))),


								user.profile.biography ?
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-biography' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'p', /* istanbul ignore next */null,
										user.profile.biography),

									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-biography' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'p', /* istanbul ignore next */null, /* istanbul ignore next */'No biography.'),


									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)),

								user.profile.publicEmailAdress ?
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-link' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h3', /* istanbul ignore next */null, /* istanbul ignore next */'Email: '),
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'span', /* istanbul ignore next */null,
										user.profile.publicEmailAdress),

									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


								'',
								user.profile.academiaEdu ?
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-link' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h3', /* istanbul ignore next */null, /* istanbul ignore next */'Academia:'),
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'a', /* istanbul ignore next */{
											href: user.profile.academiaEdu,
											target: '_blank',
											rel: 'noopener noreferrer' },

										user.profile.academiaEdu),

									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


								'',
								user.profile.twitter ?
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-link' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h3', /* istanbul ignore next */null, /* istanbul ignore next */'Twitter:'),
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'a', /* istanbul ignore next */{
											href: user.profile.twitter,
											target: '_blank',
											rel: 'noopener noreferrer' },

										user.profile.twitter),

									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


								'',
								user.profile.facebook ?
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-link' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h3', /* istanbul ignore next */null, /* istanbul ignore next */'Facebook:'),
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'a', /* istanbul ignore next */{
											href: user.profile.facebook,
											target: '_blank',
											rel: 'noopener noreferrer' },

										user.profile.facebook),

									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


								'',
								user.profile.google ?
								/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'public-profile-link' },
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h3', /* istanbul ignore next */null, /* istanbul ignore next */'Google:'),
									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'a', /* istanbul ignore next */{
											href: user.profile.google,
											target: '_blank',
											rel: 'noopener noreferrer' },

										user.profile.google),

									/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'br', /* istanbul ignore next */null)) :


								'')),


						/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'article-content' },
							/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{
								id: 'container1',
								className: 'data-visualization' }),

							/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{
								id: 'container2',
								className: 'data-visualization' })),


						/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'hr', /* istanbul ignore next */{ className: 'user-divider' }),
						/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'div', /* istanbul ignore next */{ className: 'user-discussion-comments' },
							/* istanbul ignore next */_react2.default.createElement( /* istanbul ignore next */'h2', /* istanbul ignore next */null, /* istanbul ignore next */'Comments'),
							/* istanbul ignore next */_react2.default.createElement(DiscussionCommentsList, /* istanbul ignore next */{
								discussionComments: discussionComments }))))));






	} }); // lib
// components

var PublicProfilePageContainer = /* istanbul ignore next */(0, _reactMeteorData.createContainer)(function ( /* istanbul ignore next */_ref) {/* istanbul ignore next */var userId = _ref.userId;
	var user = {};
	var discussionComments = [];

	/* istanbul ignore next */_meteor.Meteor.subscribe('users.id', userId);
	/* istanbul ignore next */_meteor.Meteor.subscribe('user.discussionComments', userId, /* istanbul ignore next */_session.Session.get('tenantId'));

	user = /* istanbul ignore next */_meteor.Meteor.users.findOne({
		_id: userId });


	discussionComments = /* istanbul ignore next */_discussionComments2.default.find({
		userId: userId,
		status: 'publish' }).
	fetch();

	discussionComments.forEach(function (discussionComment, discussionCommentIndex) {
		var commentHandle = /* istanbul ignore next */_meteor.Meteor.subscribe('comments', {
			_id: discussionComment.commentId },
		0, 1);
		if (commentHandle.ready()) {
			var comments = Comments.find().fetch();
			if (comments.length) {
				discussionComments[discussionCommentIndex].comment = comments[0];
			} else {
				discussionComments[discussionCommentIndex].comment = {
					work: '',
					subwork: '',
					discussionComments: [] };

			}
		} else {
			discussionComments[discussionCommentIndex].comment = {
				work: '',
				subwork: '',
				discussionComments: [] };

		}

		discussionComments[discussionCommentIndex].otherCommentsCount = /* istanbul ignore next */_discussionComments2.default.find({
			commentId: discussionComment.commentId }).
		count();
	});

	if (user) {
		/* istanbul ignore next */undefined.checkUsername(user);
	}

	return {
		user: user,
		discussionComments: discussionComments };

}, PublicProfilePage); /* istanbul ignore next */exports.default =

PublicProfilePageContainer;